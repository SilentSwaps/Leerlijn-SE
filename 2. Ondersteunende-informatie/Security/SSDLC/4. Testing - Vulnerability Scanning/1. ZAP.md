---
title: ZAP
draft: "true"
---
## Pentesting

Het testen van de security van een applicatie heeft als doel om er achter te komen waar mogelijke risico's en zwaktes zitten. Een onderdeel hiervan is penetration testing, ook bekend als pentesting. Pentesting houdt in dat je je voordoet als een mogelijke aanvaller van de applicatie. Je probeert door middel van bekende aanvallen risico's te ontdekken of zwakheden te benutten. Pentesting is onderdeel van de testing fase in de SSDLC.

Pentesting bestaat uit de volgende 3 stappen:

1. **Ontdekken** - Het verzamelen van informatie over de website. Denk hierbij aan alle bestaande URL's, robots.txt, externe frameworks en packages, de gebruikte webserver met versie.

2. **Aanvallen** - Het uitvoeren van aanvallen aan de hand van de ontdekte informatie.

3. **Rapporteren** - Het rapporteren en beschrijven van de gevonden veiligheidsrisico's

## ZAP

Pentesting kan zowel handmatig, als automatisch gedaan worden. Er bestaan vele tools om dit te automatiseren. Bij de bronnenlijst van deze pagina zijn er aantal te vinden, maar deze pagina gaat in op het gebruik van ZAP.

ZAP staat voor "Zed Attack Proxy" en is een gratis en open source tool gemaakt voor het testen van webapplicaties. ZAP wordt omschreven als een Man-in-the-middle proxy, omdat het tussen de browser en de webapplicatie inzit. Het kan gemakkelijk requests en responses inzien, vasthouden en wijzigen.

### Proxy

Een proxy werkt als een tussenstap tussen een client en een server. Wanneer een client een verzoek (request) naar een server stuurt, kan dit verzoek eerst naar een proxy worden gestuurd. De proxy ontvangt het verzoek, evalueert en transformeert het indien nodig, en stuurt het vervolgens door naar de server. De server verwerkt het verzoek en stuurt een respons terug naar de proxy, die de respons vervolgens terugstuurt naar de client. Deze tussenstap biedt verschillende voordelen en mogelijkheden, zoals:

- **Veiligheid**: Een proxy kan fungeren als een firewall, verzoeken filteren en voorkomen dat kwaadaardige verzoeken de server bereiken.

- **Privacy**: Door het gebruik van een proxy kunnen de IP-adressen van de clients worden verborgen, wat helpt bij het beschermen van de privacy.

- **Caching**: Proxies kunnen veelgevraagde inhoud opslaan (cachen), waardoor de tijd die nodig is om deze inhoud aan de client te leveren, wordt verkort.

- **Load Balancing**: Proxies kunnen het inkomende verkeer verdelen over meerdere servers, waardoor de belasting gelijkmatig wordt verdeeld en de prestaties worden verbeterd.

- **Inhoud Manipulatie**: Proxies kunnen verzoeken en reacties aanpassen, zoals het toevoegen van headers, het omzetten van HTTPS naar HTTP, en het uitvoeren van authenticatie.

Een proxy ziet er uit als volgt:

``` mermaid
---
title: Proxy to single server
---
graph LR
    Client -->|Request| Proxy
    Proxy -->|Transformed Request| Server
    Server -->|Response| Proxy
    Proxy -->|Transformed Response| Client
```

### ZAP als proxy

ZAP is een gespecialiseerde proxy ontworpen voor het testen van webapplicaties op beveiligingskwetsbaarheden. In plaats van zich te richten op het beveiligen van gegevens of het optimaliseren van netwerkverkeer, is ZAP gericht op het identificeren, analyseren en exploiteren van mogelijke beveiligingsproblemen. Dit doet ZAP door de volgende taken uit te voeren:

- **Inspecteren**: ZAP kan inkomende en uitgaande HTTP/HTTPS-verzoeken en -reacties bekijken, vastleggen en analyseren. Dit maakt het mogelijk om te zien welke gegevens tussen de client en de server worden uitgewisseld.

- **Manipuleren**: ZAP kan verzoeken en reacties onderweg wijzigen. Dit kan worden gebruikt om te testen hoe de webapplicatie reageert op onverwachte of kwaadaardige invoer.

- **Scannen**: ZAP bevat functies voor het automatisch scannen van webapplicaties om bekende kwetsbaarheden te identificeren, zoals SQL-injecties, cross-site scripting (XSS), en meer. Bij een passieve scan observeert ZAP het verkeer zonder het te wijzigen. Bij een actieve scan stuurt ZAP speciaal geconstrueerde verzoeken naar de applicatie om kwetsbaarheden op te sporen.

ZAP als proxy ziet er als volgt uit:

``` mermaid
---
title: ZAP as proxy
---
graph LR
subgraph Your device 
direction LR
    ZAP -->|Transformed Response| Browser
    Browser -->|Request| ZAP
end
    ZAP -->|Transformed Request| WebServer
    WebServer -->|Response| ZAP
```

## Ontdekken

De eerste stap is het ontdekken van de webapplicatie. ZAP heeft hier een aantal tools voor.

### Spiders

ZAP heeft 2 spiders voor het in kaart brengen van web applicaties. De traditionele spider begint met een aantal start-URL's en ontdekt meer URL's door recursief de HTML in responses van de webapplicatie te onderzoeken.

Tijdens het verwerken van een URL, maakt de spider een request om de bijbehorende resource op te halen en verwerkt de response om nieuwe hyperlinks te ontdekken. In de [documentatie van ZAP](https://www.zaproxy.org/docs/desktop/addons/spider/) is te vinden welke tags er worden geanalyseerd.

De traditionele spider is snel, maar is niet altijd effectief wanneer er URL's worden gegenereerd door JavaScript. Voor AJAX-applicaties, is de AJAX spider effectiever. Deze spider onderzoekt de web applicatie door browsers te creëren die dan elke mogelijke URL op de pagina volgen. De AJAX spider is langzamer dan de traditionele spider.

Beide spiders voeren alleen passieve scans op de webapplicatie uit. Passieve scans wijzigen geen responses en zijn veilig om uit te voeren. Passief scannen is een goede manier om sommige zwakheden te vinden en om een basis overzicht te krijgen in hoe veilig de webapplicatie is. Ook kan het helpen om inzicht te krijgen op welke plekken verder getest moet worden.

### Force browse

De force browse add-on bevat een lijst aan veelvoorkomende URL's en probeert ze allemaal te bezoeken. Als de URL een niet-404 response teruggeeft, wordt de URL opgeslagen. Denk hierbij aan URL's als `http://example.com/admin.php`, `http://example.com/logs` en `http://example.com/passwd.bak`. Omdat dit een brute-force process is kan het, afhankelijk van de lengte van de lijst, veel tijd in beslag nemen.

### HUD

De derde methode is om via de HUD handmatig de webapplicatie te ontdekken. Hierbij kun je zoals je dit normaal gesproken in de browser doet je website bezoeken en worden alle ingeladen en bezochte URL's opgeslagen. Dit kan het makkelijker maken om bijvoorbeeld een ingelogde pagina te indexen, of een pagina bezoeken waar niet rechtstreeks naar gelinkt wordt. (Voor de AJAX spider is het ook mogelijk om ingelogde pagina's te bezoeken, maar hier is extra configuratie voor nodig).

## Aanvallen

Nu je weet hoe de applicatie er uit ziet, welke resources er ingeladen worden en welke pagina's je kunt bezoeken, is de tweede stap in het pentesting process het aanvallen van de applicatie. Ook hier biedt ZAP meerdere tools voor aan.

⚠️ Let op: het starten van deze tools start een daadwerkelijke aanval op de website. Doe dit alleen op websites waar je expliciete toestemming hebt om deze aan te vallen.

### Active scan

Active scannen probeert mogelijke zwakheden te vinden door bekende aanvallen tegen de ontdekte targets te gebruiken. Denk hierbij aan SQL Injection, Cross Site Scripting en het zoeken naar verborgen bestanden. De volledige lijst aan active scan rules zijn te vinden in de [documentatie van ZAP](https://www.zaproxy.org/docs/desktop/addons/active-scan-rules/).

### Fuzzer

Fuzzing is een techniek waarbij er onverwachts veel data naar een target wordt gestuurd. Dit is meestal ongeldige data. Een voorbeeld hiervan is een enum. In C# wordt een enum standaard opgeslagen als een integer. Als je op een website een keuze kan maken uit een enum-waarde, zou je ook een getal buiten het bereik van de enum kunnen meesturen. Als je webapplicatie dit incorrect afhandeld, kan dit leiden tot een Denial of Service (DoS) of een buffer overflow. Meer voorbeelden en methoden voor fuzzing staan op de [website van Owasp](https://owasp.org/www-community/Fuzzing).

### Handmatig

Niet alle veiligheidsrisico's kunnen door ZAP gevonden worden. Sommige veiligheidsrisico's zijn niet door de computer te ontdekken, denk bijvoorbeeld aan broken acces control. Hoe veilig je webapplicatie ook is, je kunt niet voorkomen dat iemand zijn wachtwoord aan iemand anders vertelt. Je kunt wel hier tegen beveiligen, denk bijvoorbeeld aan two-factor-authentication (2FA).

## Rapporteren

Na het aanvallen van de applicatie komt nu de belangrijkste taak: Hoe ga je de gevonden zwakheden oplossen? Er bestaan meerdere manieren om in ZAP in te zien welke kwetsbaarheden gevonden zijn.

### Alerts

In ZAP worden alle gevonden kwetsbaarheden getoond als alert. Hier worden ze onderverdeeld onder risicocategorieën. De categorieën zijn: *High*, *Medium*, *Low*, *Informational* en *False Positive*. Bij elk alert is in te zien welk request en response deze alert heeft gevonden. Ook wordt er getoond wat voor kwetsbaarheid er is gevonden en wat een mogelijke oplossing is. Deze alerts kunnen samengevoegd worden tot een overzichtelijk rapport.

### Rapport

ZAP biedt de mogelijkheid om automatisch rapporten te genereren van de uitgevoerde scans en bevindingen. Wanneer je een rapport hebt gegenereerd, kun je zoeken naar kwetsbaarheden met een hoge of kritieke prioriteit. Vind hier de gedetailleerde beschrijvingen van deze kwetsbaarheden, inclusief het bewijs van de kwetsbaarheid (bijv. voorbeeldrequests en -responses). Beoordeel het risico dat elke kwetsbaarheid vormt voor de applicatie. Let op dat het ook mogelijk dat ZAP false positives heeft gegenereerd. Kijk kritisch of een risico daadwerkelijk een risico is. Bij een kwetsbaarheid staat vaak een aanbevolen oplossing om deze kwetsbaarheid tegen te gaan.

Het rapport kan op verschillende manieren worden gebruikt:

- **Beveiligingsanalyse**: Gebruik het rapport als basis voor een diepere beveiligingsanalyse en om prioriteiten te stellen voor beveiligingsverbeteringen. Nu je weet waar ZAP risico's heeft gevonden, is het belangrijk om deze verder te onderzoeken. Probeer handmatig de kwetsbaarheid te gebruiken en verzin een oplossing om dit te verhelpen.

- **Communicatie**: Het rapport, of een samenvatting hiervan, kan goed laten zien welke stappen worden ondernomen om beveiligingsproblemen aan te pakken. Het kan goed zijn om het risico te koppelen aan een item uit de ASVS lijst. Hierdoor is het duidelijk welk ASVS-item nog werk nodig heeft.

## Begrippenlijst

- **ZAP**: Zed Attack Proxy
- **Proxy**: Een tussenstap tussen client en server
- **ASVS**: Application Security Verification Standard

## Bronnen

- <https://www.zaproxy.org/getting-started/>
- <https://en.wikipedia.org/wiki/Penetration_test>
- <https://owasp.org/www-community/Vulnerability_Scanning_Tools>
